<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Real Kundali Generator</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; }
    input, select, button { padding: 10px; margin: 5px 0; width: 100%; max-width: 200px; }
    #result { white-space: pre-wrap; background: #222; color: #0f0; padding: 15px; border-radius: 8px; margin-top: 20px; }
    label { display: block; margin-top: 15px; }
  </style>
</head>
<body>

  <h1>Real Kundali Generator</h1>
  <form id="kundaliForm">
    <label>Full Name: <input type="text" name="name" required /></label>
    <label>Date of Birth: <input type="date" id="dob" required /></label>

    <label>Time of Birth:</label>
    <input type="number" id="hour" min="1" max="12" placeholder="Hour (1-12)" required />
    <input type="number" id="minute" min="0" max="59" placeholder="Minute (0-59)" required />
    <select id="ampm" required>
      <option value="AM">AM</option>
      <option value="PM">PM</option>
    </select>

    <label>Place of Birth (City): <input type="text" id="place" placeholder="e.g. Kathmandu" required /></label>

    <button type="submit">Generate Kundali</button>
  </form>

  <div id="result"></div>

  <script>
    const form = document.getElementById("kundaliForm");
    const resultDiv = document.getElementById("result");

    async function getLatLon(city) {
      const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(city)}`);
      const data = await response.json();
      if(data && data.length > 0){
        return { lat: parseFloat(data[0].lat), lon: parseFloat(data[0].lon) };
      } else {
        throw new Error("Location not found");
      }
    }

    function convertTo24Hour(hour, ampm) {
      hour = parseInt(hour);
      if(ampm === "PM" && hour !== 12) hour += 12;
      if(ampm === "AM" && hour === 12) hour = 0;
      return hour;
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      resultDiv.textContent = "Calculating Kundali... Please wait.";

      try {
        const name = form.name.value.trim();
        const dob = document.getElementById("dob").value;
        const hour12 = document.getElementById("hour").value;
        const minute = document.getElementById("minute").value;
        const ampm = document.getElementById("ampm").value;
        const place = document.getElementById("place").value.trim();

        if(!dob) throw new Error("Please select DOB");
        if(!hour12 || !minute) throw new Error("Please enter time");

        const [year, month, day] = dob.split("-").map(Number);

        // Get lat lon from place
        const { lat, lon } = await getLatLon(place);

        // Timezone offset in hours
        // For demo, we'll use Intl API, but it's not perfect for all locations.
        // You can hardcode Nepal 5.75 or improve with timezone lookup libs.
        const timezone = new Date().toLocaleString("en-US", {timeZoneName: "short"});
        let tzone = 0;
        // Approximate timezone offset in hours (you can improve)
        const tzOffsetMinutes = new Date().getTimezoneOffset();
        tzone = -tzOffsetMinutes / 60;

        const hour24 = convertTo24Hour(hour12, ampm);

        // Your API credentials here
        const userId = "YOUR_USER_ID";
        const apiKey = "YOUR_API_KEY";

        const apiUrl = "https://json.astrologyapi.com/v1/basic_horoscope";

        const requestBody = {
          day: day,
          month: month,
          year: year,
          hour: hour24,
          min: parseInt(minute),
          lat: lat,
          lon: lon,
          tzone: tzone
        };

        const response = await fetch(apiUrl, {
          method: "POST",
          headers: {
            "Authorization": "Basic " + btoa(userId + ":" + apiKey),
            "Content-Type": "application/json"
          },
          body: JSON.stringify(requestBody)
        });

        const data = await response.json();

        if(data.error) {
          resultDiv.textContent = "Error: " + data.message;
          return;
        }

        // You can replace this with better chart UI code:
        resultDiv.textContent = `Kundali for ${name}:\n\n${JSON.stringify(data, null, 2)}`;

      } catch (err) {
        resultDiv.textContent = "Error: " + err.message;
      }
    });
  </script>

</body>
</html>


  <h1>üßò Kundali & üñêÔ∏è Palm Reading</h1>

  <!-- üîÆ Kundali Section -->
  <div class="section">
    <h2>üßò Generate Your Kundali</h2>
    <form id="kundaliForm">
      <input type="text" name="name" required placeholder="Full Name">
      <input type="date" name="dob" required>
      <input type="time" name="tob" required>
      <input type="text" name="pob" required placeholder="Place of Birth (City)">
      <button type="submit">Generate Kundali</button>
    </form>
    <div id="kundaliResult"></div>
  </div>

  <!-- ‚úã Palm Reading Section -->
  <div class="section">
    <h2>üñêÔ∏è Palm Reading</h2>
    <button onclick="playSound(); openCamera()">üì∑ Open Camera</button>
    <button onclick="playSound(); capturePhoto()">üì∏ Capture</button>
    <input type="file" id="imageUpload" accept="image/*">
    <video id="video" width="400" height="300" autoplay playsinline style="display:none;"></video>
    <canvas id="palmCanvas" width="400" height="500"></canvas>
    <button onclick="playSound(); analyzeLines()">üîç Analyze</button>
    <button onclick="playSound(); clearCanvas()">‚ôªÔ∏è Reset</button>
    <div id="output"></div>
  </div>

  <!-- üîä Click Sound -->
  <audio id="clickSound" src="https://assets.mixkit.co/sfx/preview/mixkit-interface-click-1126.mp3" preload="auto"></audio>

  <footer>üîß Powered by <span>KUSHAL ViP</span></footer>
