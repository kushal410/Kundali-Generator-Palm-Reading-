<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kundali Generator</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 500px;
    margin: 30px auto;
    background: #f5f5f5;
    padding: 20px;
    border-radius: 8px;
  }
  label {
    display: block;
    margin-top: 15px;
  }
  input, select, button {
    width: 100%;
    padding: 10px;
    margin-top: 5px;
    font-size: 1em;
  }
  button {
    background: #2575fc;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 5px;
    margin-top: 20px;
  }
  button:hover {
    background: #1a54d9;
  }
  #result {
    white-space: pre-wrap;
    background: #222;
    color: #0f0;
    margin-top: 30px;
    padding: 15px;
    border-radius: 8px;
    min-height: 200px;
    font-family: monospace;
    overflow-x: auto;
  }
</style>
</head>
<body>

<h1>Kundali Generator</h1>

<form id="kundaliForm">
  <label for="name">Full Name:</label>
  <input type="text" id="name" required />

  <label for="dob">Date of Birth:</label>
  <input type="date" id="dob" required />

  <label>Time of Birth:</label>
  <input type="number" id="hour" min="1" max="12" placeholder="Hour (1-12)" required style="width: 48%; display: inline-block;"/>
  <input type="number" id="minute" min="0" max="59" placeholder="Minute (0-59)" required style="width: 48%; display: inline-block; margin-left: 4%;" />
  <select id="ampm" required style="width: 100%; margin-top: 10px;">
    <option value="AM">AM</option>
    <option value="PM">PM</option>
  </select>

  <label for="place">Place of Birth (City):</label>
  <input type="text" id="place" placeholder="e.g. Kathmandu" required />

  <button type="submit">Generate Kundali</button>
</form>

<div id="result"></div>

<script>
async function getLatLon(city) {
  const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(city)}`);
  const data = await res.json();
  if(data.length === 0) throw new Error("Location not found");
  return { lat: parseFloat(data[0].lat), lon: parseFloat(data[0].lon) };
}

function convertTo24Hour(hour, ampm) {
  hour = parseInt(hour);
  if(ampm === "PM" && hour !== 12) hour += 12;
  if(ampm === "AM" && hour === 12) hour = 0;
  return hour;
}

// Approximate timezone offset for place (improvement: use timezone API)
function getLocalTimezoneOffset() {
  return -new Date().getTimezoneOffset()/60; // in hours
}

document.getElementById("kundaliForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const resultDiv = document.getElementById("result");
  resultDiv.textContent = "Calculating Kundali... Please wait.";

  try {
    const name = document.getElementById("name").value.trim();
    const dob = document.getElementById("dob").value;
    const hourInput = document.getElementById("hour").value;
    const minuteInput = document.getElementById("minute").value;
    const ampm = document.getElementById("ampm").value;
    const place = document.getElementById("place").value.trim();

    if(!dob) throw new Error("Date of birth is required");
    if(!hourInput || !minuteInput) throw new Error("Time of birth is required");
    if(!place) throw new Error("Place of birth is required");

    const [year, month, day] = dob.split("-").map(Number);
    const hour24 = convertTo24Hour(hourInput, ampm);
    const minute = parseInt(minuteInput);

    // Get lat lon from place
    const { lat, lon } = await getLatLon(place);

    // Use approximate timezone offset here, can be enhanced with timezone API
    const tzone = getLocalTimezoneOffset();

    // Your API credentials from vedicrishiastro.com
    const userId = "YOUR_USER_ID";
    const apiKey = "YOUR_API_KEY";

    const apiUrl = "https://json.astrologyapi.com/v1/basic_horoscope";

    const payload = {
      day,
      month,
      year,
      hour: hour24,
      min: minute,
      lat,
      lon,
      tzone
    };

    const response = await fetch(apiUrl, {
      method: "POST",
      headers: {
        "Authorization": "Basic " + btoa(userId + ":" + apiKey),
        "Content-Type": "application/json"
      },
      body: JSON.stringify(payload)
    });

    const data = await response.json();

    if(data.error) {
      throw new Error(data.message || "Failed to generate Kundali");
    }

    // Display a simple Kundali output
    let output = `Kundali for ${name}:\n\n`;
    output += `DOB: ${dob} Time: ${hourInput}:${minuteInput} ${ampm}\n`;
    output += `Place: ${place} (Lat: ${lat.toFixed(4)}, Lon: ${lon.toFixed(4)})\n\n`;

    // Example of planets and houses
    if(data.horoscope && data.horoscope.length > 0){
      output += "Planets and their positions:\n";
      data.horoscope.forEach(item => {
        output += `- ${item.planet}: House ${item.house}, Sign ${item.sign}\n`;
      });
    } else {
      output += "No horoscope data available.\n";
    }

    resultDiv.textContent = output;

  } catch (err) {
    resultDiv.textContent = "Error: " + err.message;
  }
});
</script>

</body>
</html>

<h1>🖐️ Palm Reading App</h1>
<p style="font-size: 1.2em; color: #333; margin-top: -10px; margin-bottom: 20px; font-style: italic;">
  "Your future is in your hands. Let your palm reveal the path."
</p>


  <div>
    <button onclick="playSound(); openCamera()">📷 Open Camera</button>
    <button onclick="playSound(); capturePhoto()">📸 Capture</button>
    <input type="file" id="imageUpload" accept="image/*" />
  </div>

  <video id="video" width="400" height="300" autoplay playsinline style="display:none;"></video>
  <canvas id="palmCanvas" width="400" height="500"></canvas>

  <div id="buttons">
    <button onclick="playSound(); analyzeLines()">🔍 Analyze</button>
    <button onclick="playSound(); clearCanvas()">♻️ Reset</button>
  </div>

  <div id="output"></div>

  <footer>
    🔧 Powered by <span>KUSHAL ViP</span>
  </footer>

  <!-- 🔊 Sound Effect -->
  <audio id="clickSound" src="https://assets.mixkit.co/sfx/preview/mixkit-interface-click-1126.mp3" preload="auto"></audio>

  <script>
    const video = document.getElementById("video");
    const canvas = document.getElementById("palmCanvas");
    const ctx = canvas.getContext("2d");
    const clickSound = document.getElementById("clickSound");
    let img = new Image();
    let drawing = false;
    let lines = [];
    let stream;

    function playSound() {
      clickSound.currentTime = 0;
      clickSound.play();
    }

    async function openCamera() {
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
        video.style.display = "block";
      } catch (err) {
        alert("Camera access denied or not available.");
      }
    }

    function capturePhoto() {
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      video.pause();
      video.srcObject.getTracks().forEach(track => track.stop());
      video.style.display = "none";
    }

    document.getElementById("imageUpload").addEventListener("change", function (e) {
      const reader = new FileReader();
      reader.onload = function (event) {
        img.onload = function () {
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(e.target.files[0]);
    });

    canvas.addEventListener("mousedown", (e) => {
      drawing = true;
      ctx.beginPath();
      ctx.moveTo(e.offsetX, e.offsetY);
      lines.push([{ x: e.offsetX, y: e.offsetY }]);
    });

    canvas.addEventListener("mousemove", (e) => {
      if (!drawing) return;
      ctx.lineTo(e.offsetX, e.offsetY);
      ctx.strokeStyle = "red";
      ctx.lineWidth = 2;
      ctx.stroke();
      lines[lines.length - 1].push({ x: e.offsetX, y: e.offsetY });
    });

    canvas.addEventListener("mouseup", () => {
      drawing = false;
    });

    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (img.src) ctx.drawImage(img, 0, 0);
      lines = [];
      document.getElementById("output").innerHTML = "";
    }

    function analyzeLines() {
      if (lines.length === 0) {
        alert("Please draw some lines first!");
        return;
      }

      let output = "<h3>🔮 Your Palm Reading:</h3><ul>";
      if (lines.length >= 1) output += "<li><b>Heart Line:</b> Deep emotions and caring nature.</li>";
      if (lines.length >= 2) output += "<li><b>Head Line:</b> Sharp thinking and decision-making.</li>";
      if (lines.length >= 3) output += "<li><b>Life Line:</b> Energetic and adventurous spirit.</li>";
      if (lines.length >= 4) output += "<li><b>Fate Line:</b> A unique and destined life path.</li>";
      if (lines.length >= 5) output += "<li><b>Extra Lines:</b> Highly intuitive and insightful.</li>";
      output += "</ul>";

      document.getElementById("output").innerHTML = output;
    }
  </script>
</body>
</html>


